# Motus Version 2.0 API #

**Paul Morril**,
5 September 2017

Each request requires the single json={} parameter, with contents as
described.

Common Parameters:

 - **date**: REQUIRED on all requests; formatted as YYYYMMDDHHMMSS in GMT
 - **login**: optional unless authentication required on call
 - **pword**: optional unless authentication required on call
 - **fmt**: optional, defaults to `json`

Authentication is normally not required (exceptions below), but
unauthenticated requests will not return private information.

## 1. Querying Projects ##

### 1.1 List projects with basic information ###

    /api/projects

Additional Parameters: none

### 1.2 List projects with descriptions ###

    /api/projects/descriptions

Additional Parameters: none

## 2. Querying Receivers ##

### 2.1 List receivers ###

    /api/receivers

(alias: /api/receivers/list)

Additional Parameters:

 - **status**: filter on basis of deployment status (0|1|2)

### 2.2 List Receiver Deployments (nested version) ###

This version includes JSON nested structures for individual antennas (csv is
not supported)

    /api/receivers/sensordeployments

Additional parameters:

 - **projectID**: filter by a single project ID
 - **year**: filter by year deployment started
 - **serialNo**: filter by receiverID
 - **status**: filter by deployment status (0|1|2)

### 2.3 List Receiver Deployments (flat version: json or csv) ###

    /api/receivers/deployments

Additional parameters:

 - **projectID**: filter by a single project ID
 - **year**: filter by year deployment started
 - **serialNo**: filter by receiverID
 - **status**: filter by deployment status (0|1|2)

### 2.4 List Receiver Antennas ###

    /api/receivers/antennas

Additional parameters:

 - **projectID**: filter by project ID
 - **serialNo**: filter by receiverID
 - **status**: filter by deployment status

## 3. Querying Tags ##

### 3.1 List Tags ###

    /api/tags/

(alias: /api/tags/list)

Additional parameters:

 - **projectID**: filter by project ID
 - **year**: filter by year deployment began
 - **mfgID**: filter by manufacturers id

### 3.2 Search Tag Deployments ###

    /api/tags/search

Additional parameters:

 - **projectID**: filter on project id
 - **status**: filter on deployment status (0|1|2)
 - **mfgID**: filter on manufacturer id
 - **qSearchMode**: set deployment period search mode (`startsBetween`|`overlap`)
 - **tsStart**: unix timestamp, start of deployment
 - **tsEnd**: unix timestamp, end of deployment

## 4. Miscellaneous Querying ##

### 4.1 Validating a user ###

Check that credentials are valid. If so, return basic user information
and a list of projects that the user can access.

    /api/user/validate

Additional parameters:

 - **login**: users login name
 - **pword**: users password

### 4.2 List Species ###

    /api/species

Additional parameters:

 - **qstr**: a search string from common or scientific name.
 - **qgroup**: filter on a group (`bird`|`mammal`|..)
 - **qlang**: search common name for this language (`en` |  `fr` | `cd`)

### 4.3 List receiver status ###

    /api/receiverstatus

## 5. Registering Tags, Receivers and Projects ##

### 5.1 Register a tag ###

    /api/tag/register

**Name** | **Required** | **Default value** | **Description**
---|---|---|---
fmt | No | false | Supported output formats: json, jsonp
projectID | Yes | n/a | Motus numeric project ID.
mfgID | Yes | n/a | ID printed on tag by manufacturer. If a single project is registering more than one tag with the same mfgID, (e.g. three tags with mfgID=123), the 2nd tag is called 123.1, the third tag is called 123.2, and so on. (i.e. the first tag is 123.0 = 123). For most tags, the only additional labeling we can reasonably expect users to attach is one or more indelible dots. So we tell people to add one dot to the first tag duplicating a given ID, two dots to the second tag duplicating a given ID, and so on.\
This should be a character string, as some later tags will have manufacturer IDs consisting of 8 hexadecimal digits.
dateBin | Yes | n/a | Field representing a definite time period (e.g. a quarter) of when the tag registration occurred, and that is mean to discriminate tags with the same mfgID across years or seasons within the same project. For now, this is done by combining the year (YYYY) and quarter (1-4) of the time of registration (e.g. 2015-3), but this may change to some other rule later (e.g. YYYY-MM). This field should be generated by a script based on registration time, and not be user-provided.
type | No | n/a | Type of tag (BEEPER or ID)
codeSet | No | n/a | If a manufacturer has more than one code set from which a code can come, this must uniquely identify the one for this tag. (e.g. 'Lotek-3')
manufacturer | No | n/a | Name of manufacturer (e.g. Lotek)
model | No | n/a | Tag model name
lifeSpan | No | n/a | Expected lifespan in days (integer)
nomFreq | No | 166.380 | Nominal transmitter frequency (MHz). This is typically printed on the tag by the manufacturer, as the kilohertz portion of the frequency (e.g. 380 in the case of a tag @ 166.380).
offsetFreq | No | n/a | Offset frequency (kHz)
period | No | n/a | Repeat period (seconds)
periodSD | No | n/a | standard deviation of repeat period (seconds)
pulseLen | No | n/a | Pulse length (seconds)
param1-8 | No | n/a | Up to 8 additional parameters (float numbers). Their definitions depend on the paramType field.
paramType | No | n/a | Numeric value referring to the metadata description of the (up to) 8 additional parameters param1-8. This field is not strictly required, but is expected to be provided whenever values are entered in param1-8. There is however no validation to ensure that the values in param1-8 make sense in relation to the paramType value. If you are unsure what to use here, and would like to make use of the param1-8 fields, please contact the database or API administrator.
ts | No | n/a | Timestamp at which registration occurred. This will only be useful if the registration was routed via the sensorgnome.org server because the user provided a .WAV file via email or upload, rather than using the upcoming self-registration web page.


### 5.2 Register a receiver (sensor) ###

    /api/receiver/register

Additional parameters:

 - **secretkey**: sensor hash key
 - **receiverType**: eg: LOTEKSRX800
 - **serno**: the receiver id (eg: `SG-1234BBBK678`, `Lotek-153`)

### 5.3 Register a project ###

    /api/project/register

Additional parameters:

 - **projectName**: a name for the project
 - **projectCode**: a short code for the project (not available yet on live
server)

### 5.4 Deploy a tag (untested) ###

    /api/tag/deploy

**Name ** | **Required** | **Default value** | **Description**
---|---|---|---
fmt | No | false | Supported output formats: json, jsonp
tagID | Yes | n/a | Unique numeric ID assigned to the tag, provided at the time of tag registration.
status | Yes | pending | Status from one of the possible following values: **pending, deploy, terminate**. “pending” indicates that the deployment record isn’t ready to be finalized for deployment yet. “deploy” indicates that the deployment can be activated. “terminate” will attempt to finalize a deployment by providing an end date. Note that deployments can only be activated or terminated if all required information has been provided. Attempts to deploy or terminate an incomplete deployment will return an error. At the moment, several of the parameters can no longer be modified once a deployment is activated, and the status cannot be changed back to an earlier status (permitted sequence is pending -&gt; deploy -&gt; terminate, but levels can be omitted).
tsStart | Yes | n/a | Timestamp for start of deployment (seconds since '1970-01-01T00:00:00'). If the tag has a deferred time lag (deferTime), this is the time at which the bird is released, in such a way that the time when the tag is expected to be active is given by tsStart + deferTime.
tsEnd | No\* | n/a | Timestamp for end of deployment (seconds since '1970-01-01T00:00:00'). Required for status=terminate.
deferTime | No | 0 | Defer time (in seconds from tsStart). Some tags are capable of deferred activation - they don't start transmitting until some number of seconds (can be very large) after activation.
speciesID | No | n/a | Numeric ID (integer) of the species on which the tag is being deployed. You should refer to the listspecies API entry point to query species ID based on codes or names.
speciesName | No | n/a | Name (String, preferably scientific name, but can also be common name or species code) of the species on which the tag is being deployed. There is no validation on this field, including whether it matches the speciesID value. This is strictly used as a guide for users looking at data records.
markerType | No | n/a | Type of marker (e.g. “metal band”, “color band”)
markerNumber | No | n/a | Marker number or descriptor (e.g. “1234-56789” or “L:Red/Blue,R:Metal 1234-56789”)
lat | No | n/a | Latitude (decimal degrees) of the deployment site. E.g. 45.123.
lon | No | n/a | Longitude (decimal degrees) of the deployment site. E.g. -60.325.
elev | No | n/a | Elevation above sea level (meters) of the deployment site. E.g. 23.
ts | Yes | n/a | Timestamp (seconds since '1970-01-01T00:00:00'). Time at which deployment information was generated.
comments | No | n/a | User comments related to the deployment, for their own use.
properties | No | n/a | JSON object containing pairs of name/value pairs for any custom properties for the tag. E.g. \[{"AgeID":"HY", "blood":"N", "Country":"Canada", "Include\_in\_analysis":"Y", "LocationID":"Niapiskau", "Province":"Quebec","SexID":"U"}\]. Values are currently limited to 128 chars for names and unlimited for values. Each property name must be unique.

### Output (HTTP response codes: 201) ###

  **Name **|      **Description**                                                                                | **Example values**
  ---|---|---
  importID  |     Numeric import ID assigned to the imported data record. Only deployments submitted with valid credentials immediately receive a deployment ID. Others will have a value of “pending” until they are approved within the submitted project by a principal investigator. |  1234
  deploymentID |  Deployment ID assigned to the new deployment. Only deployments submitted with valid credentials immediately receive a deployment ID. Others will have a value of “pending” until they are approved within the submitted project by a principal investigator.           |  2605, pending

### 5.5 Undeploy a tag (untested) ###

    /api/tag/undeploy

See api version 1.0 documentation for parameters (deletetagdeployment)
